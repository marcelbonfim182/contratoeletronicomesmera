<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
    <link href="styles/main.css" rel="stylesheet" />
    <link href="styles/stilo_adicional.css" rel="stylesheet" />
    
    
    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.mobile.min.js"></script>

    
    <script src="scripts/app.js"></script>
    <script src="scripts/jSignature.min.js"></script> 
    <script src="scripts/jspdf.min.js"></script>
    <script src="scripts/html2canvas.js"></script> 
    <script src="scripts/jquery.maskedinput.min.js" type="text/javascript"></script>
    <script src="scripts/modernizr.custom.js" type="text/javascript"></script>
    <script src="scripts/jquery.dlmenu.js" type="text/javascript"></script>
    <script src="scripts/NativePageTransitionsKendoAdapter.js" type="text/javascript"></script>
    
    
    
  
        <script>
            
          function okModalViewLogin() {
               $("#recebe_assinatura").html("");
        $("#modalview-login").kendoMobileModalView("close");      
      
         $('.jSignature').attr('id', 'jSignature');
                
                var canvas = document.getElementById("jSignature");
                var ctx=canvas.getContext("2d");
  
                var url = canvas.toDataURL("image/png");

                var newImg = document.createElement("img"); // create img tag
                newImg.src = url;
     
               document.getElementById('recebe_assinatura').appendChild(newImg);
              $("#recebe_assinatura").append("<div class='contratante'>CONTRATANTE</div>");
              $("#recebe_assinatura").append("<br><img src='styles/images/assinaturatabletmarcel.png'><div class='contratado'>CONTRATADO</div><br><br>");
            
            }        
    </script>
   
    
    
       <script>
         


    // Now safe to use device APIs
    

                
           
         
                   function okModalSavepdf() {
           
             $(".pagina1").append("<img src='styles/images/mesmeralogo.jpg'>");
             $(".km-view-title span").html("");
             $('.dl-menu').html("");
             $('.capa').append("<img src='styles/images/primeirapagina.jpg' style='width:100%!important; height:auto!important;'>");
           
             $(".space123").css("display","block");        
             $(".cpftitulo").css("display","block"); 
           
             var value=$.trim($(".nomedopdf").val());

                if(value.length>0)
                            {
               
            
              //VARIAVEIS REFERENTE AOS CAMPOS INPUTS                  
                                
                var nome_contratante = $(".nome_contratante").val(); 
                $(".nome_contratante").before( nome_contratante );
           
               var cpfcnpj_contratante = $(".cpfcnpj_contratante").val();
                $(".cpfcnpj_contratante").before( cpfcnpj_contratante );
                                
                var rg_contratante = $(".rg_contratante").val();
                $(".rg_contratante").before( rg_contratante );

                var cnpj_contratante = $(".cnpj_contratante").val();
                $(".cnpj_contratante").before( cnpj_contratante );
                                
                var nome_instituicao = $(".nome_instituicao").val();
                $(".nome_instituicao").before( nome_instituicao );
                                
                var endereco_contratante = $(".endereco_contratante").val();
                $(".endereco_contratante").before( endereco_contratante );
                                
                var numero_contratante = $(".numero_contratante").val();
                $(".numero_contratante").before( numero_contratante );
                                
                var bairro_contratante = $(".bairro_contratante").val();
                $(".bairro_contratante").before( bairro_contratante );
                                              
                var complemento_contratante = $(".complemento_contratante").val();
                $(".complemento_contratante").before( complemento_contratante );
                                
                var cep_contratante = $(".cep_contratante").val();
                $(".cep_contratante").before( cep_contratante );
                                
                var municipio_contratante = $(".municipio_contratante").val();
                $(".municipio_contratante").before( municipio_contratante );
                                
                var estado_contratante = $(".estado_contratante").val();
                $(".estado_contratante").before( estado_contratante );
                                
                var telefone_contratante = $(".telefone_contratante").val();
                $(".telefone_contratante").before( telefone_contratante );
                                
                var email_contratante = $(".email_contratante").val();
                $(".email_contratante").before( email_contratante );
                                
                    
                var data_servico = $(".data_servico").val();
                $(".data_servico").before( data_servico );
                 $(".dia_prazoseperiodo").append( data_servico );                
                                
                                
                var horario_servico = $(".horario_servico").val();
                $(".horario_servico").before( horario_servico );
                                
                var convidados_servico = $(".convidados_servico").val();
                $(".convidados_servico").before( convidados_servico );
                                
                var local_servico = $(".local_servico").val();
                $(".local_servico").before( local_servico );
                                
                var endereco_servico = $(".endereco_servico").val();
                $(".endereco_servico").before( endereco_servico );
                                
                var numero_servico = $(".numero_servico").val();
                $(".numero_servico").before( numero_servico );
                                
                var bairro_servico = $(".bairro_servico").val();
                $(".bairro_servico").before( bairro_servico );
                                
                var complemento_servico = $(".complemento_servico").val();
                $(".complemento_servico").before( complemento_servico );
                                
                var cep_servico = $(".cep_servico").val();
                $(".cep_servico").before( cep_servico );
                                
                var municipio_servico = $(".municipio_servico").val();
                $(".municipio_servico").before( municipio_servico );
                                
                var estado_servico = $(".estado_servico").val();
                $(".estado_servico").before( estado_servico );
                                
                var representante_servico = $(".representante_servico").val();
                $(".representante_servico").before( representante_servico );
                                
                var contato_servico = $(".contato_servico").val();
                $(".contato_servico").before( contato_servico );
                                
                                
                                
                                
                var preco_orcamento = $(".preco_orcamento").val();
                $(".preco_orcamento").before( "R$"+preco_orcamento );
                                
                var aditivodesc_orcamento = $(".aditivodesc_orcamento").val();
                $(".aditivodesc_orcamento").before( "R$"+aditivodesc_orcamento );
                                
                var frete_orcamento = $(".frete_orcamento").val();
                $(".frete_orcamento").before( "R$"+frete_orcamento );                
                                
                               
          
                  
                var total_orcamento = $(".total_orcamento").val();
                $(".total_orcamento").before( total_orcamento );
                
            
                                

                                
                var dropdown = $( "#dropdown option:selected" ).text();
                $("#dropdown").before( dropdown );                 
                                
                                
                  
                $(".contratantes_inputs input").css("display","none");                 
                $(".contratantes_inputs select").css("display","none");                
                                
                                
                         
                 
           
             nomedodocumento = $(".nomedopdf").val() + ".pdf";
              
           
         	var pdf = new jsPDF('p', 'pt', 'letter')

	// source can be HTML-formatted string, or a reference
	// to an actual DOM element from which the text will be scraped.
	, source = $('.gerarpdf')[0]

	// we support special element handlers. Register them with jQuery-style 
	// ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
	// There is no support for any other type of selectors 
	// (class, of compound) at this time.
	, specialElementHandlers = {
		// element with id of "bypass" - jQuery style selector
		'#bypassme': function(element, renderer){
			// true = "handled elsewhere, bypass text extraction"
			return true
		}
	}

	margins = {
      top: 80,
      bottom: 60,
      left: 40,
      width: 522
    };
    // all coords and widths are in jsPDF instance's declared units
    // 'inches' in this case
    pdf.fromHTML(
    	source // HTML string or DOM elem ref.
    	, margins.left // x coord
    	, margins.top // y coord
    	, {
    		'width': margins.width // max width of content on PDF
    		, 'elementHandlers': specialElementHandlers
    	},
    	function (dispose) {
    	  // dispose: object with X, Y of the last line add to the PDF 
    	  //          this allow the insertion of new lines after html
              
            
            var pdfOutput = pdf.output("blob");
              console.log( pdfOutput );

          console.log("file system...");
window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
 
   console.log(fileSystem.name);
   console.log(fileSystem.root.name);
   console.log(fileSystem.root.fullPath);
 
   fileSystem.root.getFile('contratos/'+nomedodocumento, {create: true}, function(entry) {
      var fileEntry = entry;
      console.log(entry);
 
      entry.createWriter(function(writer) {
         writer.onwrite = function(evt) {
         console.log("write success");
      };
 
      console.log("writing to file");
         writer.write( pdfOutput );
      }, function(error) {
         console.log(error);
      });
 
   }, function(error){
      console.log(error);
   });
},
function(event){
 console.log( evt.target.error.code );
});     
       },
    	margins
    )           

            navigator.notification.alert(
            'Contrato salvo com sucesso!',  // message
            'Atenção',// title
            'Atenção',// title
            'Ok'                  // buttonName
        );
        $(".nomedopdf").val("");
        $("#modalview-savenomedoarquivo").kendoMobileModalView("close");
        $(".contratantes_inputs input").css("display","block");
        $(".contratantes_inputs select").css("display","block");
                                
                                
             } else {
                 
           navigator.notification.alert(
            'Opa! Você esqueceu de nomear o contrato.',  // message
            'Atenção',// title
            'Atenção',// title
            'Ok'                  // buttonName
        );  
                 
              
             } 
                    
                 setTimeout(function() {
                        $(".pagina1").html("");
                        $(".km-view-title span").append("Contrato Eventogram");
                        $(".space123").css("display","none");
                        $('.dl-menu').append('<li><span onclick="contrato_eventogram()"><img src="styles/images/eventogram_icon.png"><div>EVENTOGRAM</div></span></li><li><span onclick="contrato_photogramma()"><img src="styles/images/photogramma_icon.png"><div>PHOTOGRAMMA</div></span></li><li><span onclick="contrato_inky()"><img src="styles/images/inky.png"><div>INKY</div></span></li>');
                        $('.capa').html("");
                         $(".cpftitulo").css("display","none"); 
                 }, 3000);
                       
             
                       
          };      
           
           
              
           
          
        </script>  
    <script>
    //CRIA PASTA NO DIRETORIO RAIZ PARA ARMAZENAR OS PDFS
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRequestFileSystemSuccess, null); 

function onRequestFileSystemSuccess(fileSystem) { 
        var entry=fileSystem.root; 
        entry.getDirectory("contratos", {create: true, exclusive: false}, onGetDirectorySuccess, onGetDirectoryFail); 
} 

function onGetDirectorySuccess(dir) { 
      console.log("Created dir "+dir.name); 
} 

function onGetDirectoryFail(error) { 
     console.log("Error creating directory "+error.code); 
} 
    </script>
    
        
    <script>
        //ACESSA A CAMERA E ADICIONA A FOTO NO DOCUMENTO
 function takePicturerg() {
        navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
            destinationType: Camera.DestinationType.DATA_URL
         }); 

    function onSuccess(imageData) {
        var image = document.getElementById('fotorg');
        image.src = "data:image/jpeg;base64," + imageData;
    }

    function onFail(message) {
        alert('Failed because: ' + message);
    }
}
        
        
 function takePicturecpf() {
    navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
        destinationType: Camera.DestinationType.DATA_URL
    }); 

    function onSuccess(imageData) {
        var image = document.getElementById('fotocpf');
        image.src = "data:image/jpeg;base64," + imageData;
    }

    function onFail(message) {
        alert('Failed because: ' + message);
    }
}
   
  </script>
    
</head>
<body>
 
    <div data-role="layout" data-id="main">
        <div data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
        </div>

        <!-- application views will be rendered here -->
        
        <div data-role="footer">
            <div data-role="tabstrip">
                <a href="views/home.html" data-transition="slide:right"id="bypassme" data-icon="organize">Contratos assinados</a>   
                <a href="views/eventogram.html" data-transition="slide:left" id="bypassme" data-icon="compose">Assinar contrato</a>
            </div>
        </div>
    </div>
</body>
</html>
